{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>{{ movie.title }}</title>
</head>
<body>
    <h1>{{ movie.title }}</h1>
    <p><strong>Release Date:</strong> {{ movie.release_date }}</p>
    <p>{{ movie.genre }}</p>
    <p>{{ movie.description }}</p>

    {% if user.is_authenticated %}
  <form method="post" action="{% url 'toggle_favorite' movie.id %}">
    {% csrf_token %}
    <button type="submit">
        {% if is_favorited %}
        Remove from Favorites
      {% else %}
        Add to Favorites
      {% endif %}
    </button>
  </form>
{% else %}
  <p><a href="{% url 'login' %}?next={{ request.path }}">Login</a> to favorite this movie.</p>
{% endif %}


    {% if movie.poster %}
        <img src="{{ movie.poster.url }}" alt="{{ movie.title }} poster" width="200">
    {% endif %}

    <hr>
    <h2>Reviews</h2>

    {% for review in reviews %}
    <div>
      <p><strong>{{ review.user.username }}</strong> rated it {{ review.rating }}/5</p>
      <p>{{ review.comment }}</p>
      <p><em>{{ review.timestamp|date:"d M Y, H:i" }}</em></p>
      
      {% if review.user == user %}
        <p>
          <a href="{% url 'edit_review' review.pk %}">Edit</a> |
          <a href="{% url 'delete_review' review.pk %}">Delete</a>
        </p>
      {% endif %}
  
      <hr>
    </div>
  
    {% empty %}
      <p>No reviews yet. Be the first to review!</p>
    {% endfor %}

    {% if user.is_authenticated %}
      <h3>Leave a Review</h3>
      <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Submit</button>
      </form>
    {% else %}
      <p><a href="{% url 'login' %}">Log in</a> to leave a review.</p>
    {% endif %}

    <p><a href="{% url 'movie_list' %}">Back to list</a></p>
</body>
</html>
